@model Nop.Plugin.Misc.PurchaseOrder.Areas.Admin.Models.PurchaseOrderSearchModel
@inherits Nop.Web.Framework.Mvc.Razor.NopRazorPage<TModel>

@{
	Layout = "_AdminLayout";
	ViewBag.PageTitle = T("Plugins.Misc.PurchaseOrder.PurchaseOrders").Text;
	NopHtml.SetActiveMenuItemSystemName("PurchaseOrders");
}

@{
    const string hideSearchBlockAttributeName = "PurchaseOrderPage.HideSearchBlock";
    var hideSearchBlock = await genericAttributeService.GetAttributeAsync<bool>(await workContext.GetCurrentCustomerAsync(), hideSearchBlockAttributeName);
}

<div class="content-header clearfix">
	<h1 class="float-left">
		@ViewBag.PageTitle
	</h1>
	<div class="float-right">
		<a asp-action="Create" class="btn btn-primary">
			<i class="fas fa-plus-square"></i>
			@T("Admin.Common.AddNew")
		</a>
		<button type="button" id="exportcsv-purchaseorders" asp-action="ExportCsv" class="btn btn-success">
			<i class="fas fa-download"></i>
			@T("Admin.Common.Export")
		</button>
	</div>
</div>

<section class="content">
	<div class="container-fluid">
		<div class="form-horizontal">
			<div class="cards-group">
				<div class="card card-default card-search">
					<div class="card-body">
                        <div class="row search-row @(!hideSearchBlock ? "opened" : "")" data-hideAttribute="@hideSearchBlockAttributeName">
                            <div class="search-text">@T("Admin.Common.Search")</div>
                            <div class="icon-search"><i class="fas fa-magnifying-glass" aria-hidden="true"></i></div>
                            <div class="icon-collapse"><i class="far fa-angle-@(!hideSearchBlock ? "up" : "down")" aria-hidden="true"></i></div>
                        </div>

						<div class="search-body">
							<div class="row">
								<div class="col-md-6">
									<div class="form-group row">
										<div class="col-md-4">
											<nop-label asp-for="StartDate" />
										</div>
										<div class="col-md-8">
											<nop-editor asp-for="StartDate" asp-format="g" />
										</div>
									</div>
								</div>

								<div class="col-md-6">
									<div class="form-group row">
										<div class="col-md-4">
											<nop-label asp-for="SupplierName" />
										</div>
										<div class="col-md-8">
											<nop-select asp-for="SupplierName" asp-items="Model.AvailableSuppliers" />
										</div>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-md-6">
									<div class="form-group row">
										<div class="col-md-4">
											<nop-label asp-for="EndDate" />
										</div>
										<div class="col-md-8">
											<nop-editor asp-for="EndDate" asp-format="g" />
										</div>
									</div>
								</div>

								<div class="col-md-6">
									<div class="form-group row">
										<div class="col-md-4">
											<nop-label asp-for="ProductName" />
										</div>
										<div class="col-md-8">
											<nop-editor asp-for="ProductName" />
										</div>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="text-center col-12">
									<button type="button" id="search-purchaseorders" class="btn btn-primary btn-search">
										<i class="fas fa-search"></i>
										@T("Admin.Common.Search")
									</button>
								</div>
							</div>

						</div>
					</div>
				</div>

				<div class="card card-default">
					<div class="card-body">
						@await Html.PartialAsync("Table", new DataTablesModel
 {
	 Name = "purchaseorder-grid",
	 UrlRead = new DataUrl("List", "PurchaseOrder", null),
	 SearchButtonId = "search-purchaseorders",
	 Length = Model.PageSize,
	 LengthMenu = Model.AvailablePageSizes,
	 Filters = new List<FilterParameter>
						{
						new FilterParameter(nameof(Model.StartDate)),
						new FilterParameter(nameof(Model.EndDate)),
						new FilterParameter(nameof(Model.SupplierName)),
						new FilterParameter(nameof(Model.ProductName))
						},
	 ColumnCollection = new List<ColumnProperty>
						{
						new ColumnProperty(nameof(Nop.Plugin.Misc.PurchaseOrder.Areas.Admin.Models.PurchaseOrderModel.Id))
						{
						Title = @T("Plugins.Misc.PurchaseOrder.Fields.OrderId").Text,
						Width = "100",
						ClassName = NopColumnClassDefaults.CenterAll
						},
						new ColumnProperty(nameof(Nop.Plugin.Misc.PurchaseOrder.Areas.Admin.Models.PurchaseOrderModel.SupplierName))
						{
						Title = @T("Plugins.Misc.PurchaseOrder.Fields.SupplierName").Text,
						Width = "200",
						ClassName = NopColumnClassDefaults.CenterAll
						},
						new ColumnProperty(nameof(Nop.Plugin.Misc.PurchaseOrder.Areas.Admin.Models.PurchaseOrderModel.OrderDate))
						{
						Title = @T("Plugins.Misc.PurchaseOrder.Fields.OrderDate").Text,
						Width = "150",
						Render = new RenderDate()
						},
						new ColumnProperty(nameof(Nop.Plugin.Misc.PurchaseOrder.Areas.Admin.Models.PurchaseOrderModel.Price))
						{
						Title = @T("Plugins.Misc.PurchaseOrder.Fields.TotalAmount").Text,
						Width = "100",
						ClassName = NopColumnClassDefaults.CenterAll
						},
						new ColumnProperty(nameof(Nop.Plugin.Misc.PurchaseOrder.Areas.Admin.Models.PurchaseOrderModel.CreatedBy))
						{
						Title = @T("Plugins.Misc.PurchaseOrder.Fields.CreatedBy").Text,
						Width = "150",
						ClassName = NopColumnClassDefaults.CenterAll
						}
						}
 })
					</div>
				</div>

			</div>
		</div>
	</div>
</section>

<script>
	$(document).ready(function () {
		$("#exportcsv-purchaseorders").click(function (e) {
			e.preventDefault();
			var grid = $('#purchaseorder-grid').DataTable();
			var url = '@Url.Action("ExportCsv", "PurchaseOrder")';
			window.location.href = url;
		});
	});
</script>
